# v1.0.5 å˜æ›´è¯¦æƒ…

> **å‘å¸ƒæ—¥æœŸ**: 2026-01-08  
> **ä¸»é¢˜**: Schema éªŒè¯é»˜è®¤å¯ç”¨ + Model è‡ªåŠ¨åŠ è½½æœºåˆ¶

---

## æ ¸å¿ƒæ”¹è¿› âš¡

æœ¬æ¬¡æ›´æ–°ä¸“æ³¨äºæå‡ Model å±‚çš„æ˜“ç”¨æ€§å’Œå¼€å‘ä½“éªŒã€‚

### 1. Schema éªŒè¯é»˜è®¤å¯ç”¨ ğŸ”´

**å˜æ›´å†…å®¹**:
- Schema éªŒè¯ä»"éœ€è¦æ˜¾å¼å¯ç”¨"æ”¹ä¸º"é»˜è®¤å¯ç”¨"
- æå‡æ•°æ®è´¨é‡ï¼Œå‡å°‘è„æ•°æ®å†™å…¥
- ç¬¦åˆä¸šç•Œæœ€ä½³å®è·µï¼ˆMongooseã€Sequelize ç­‰é»˜è®¤å¯ç”¨ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
// âœ… v1.0.5: Schema éªŒè¯é»˜è®¤ç”Ÿæ•ˆ
Model.define('users', {
    schema: (dsl) => dsl({
        username: 'string:3-32!',
        email: 'email!'
    })
    // æ— éœ€é…ç½® options.validateï¼ŒéªŒè¯è‡ªåŠ¨ç”Ÿæ•ˆ
});

// æ’å…¥æ—¶è‡ªåŠ¨éªŒè¯
await User.insertOne({
    username: 'ab',  // âŒ éªŒè¯å¤±è´¥: username å¤ªçŸ­
    email: 'invalid'  // âŒ éªŒè¯å¤±è´¥: é‚®ç®±æ ¼å¼é”™è¯¯
});
// æŠ›å‡º VALIDATION_ERROR

// âœ… æ­£ç¡®æ•°æ®é€šè¿‡éªŒè¯
await User.insertOne({
    username: 'john',
    email: 'john@example.com'
});
```

**ç¦ç”¨éªŒè¯**:
```javascript
// å…¨å±€ç¦ç”¨
Model.define('users', {
    schema: ...,
    options: { validate: false }  // å…¨å±€ç¦ç”¨éªŒè¯
});

// å•æ¬¡æ“ä½œè·³è¿‡
await User.insertOne(doc, { skipValidation: true });
```

**å½±å“èŒƒå›´**:
- âœ… ç°æœ‰æœªå®šä¹‰ schema çš„ Model ä¸å—å½±å“
- âœ… å·²å®šä¹‰ schema çš„ Model è‡ªåŠ¨å¯ç”¨éªŒè¯
- âš ï¸ å¦‚éœ€ç¦ç”¨ï¼Œéœ€æ˜¾å¼é…ç½® `validate: false`

**è¿ç§»æŒ‡å—**:
```javascript
// v1.0.4: éªŒè¯éœ€è¦æ˜¾å¼å¯ç”¨
Model.define('users', {
    schema: ...,
    options: { validate: true }  // éœ€è¦é…ç½®
});

// v1.0.5: éªŒè¯é»˜è®¤å¯ç”¨
Model.define('users', {
    schema: ...
    // æ— éœ€é…ç½®ï¼Œè‡ªåŠ¨å¯ç”¨
});

// å¦‚éœ€ç¦ç”¨ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬è¡Œä¸ºï¼‰
Model.define('users', {
    schema: ...,
    options: { validate: false }  // æ˜¾å¼ç¦ç”¨
});
```

**é£é™©è¯„ä¼°**: ğŸŸ¡ ä½é£é™©
- âœ… æœªå®šä¹‰ schema çš„ Model ä¸å—å½±å“
- âœ… éªŒè¯å¤±è´¥ä¼šæŠ›å‡ºæ˜ç¡®çš„é”™è¯¯ï¼Œæ˜“äºè°ƒè¯•
- âœ… å¯é€šè¿‡é…ç½®æˆ–å•æ¬¡æ“ä½œè·³è¿‡éªŒè¯

---

### 2. Model è‡ªåŠ¨åŠ è½½æœºåˆ¶ ğŸš€

**åŠŸèƒ½è¯´æ˜**:
- è‡ªåŠ¨æ‰«ææŒ‡å®šç›®å½•ï¼ŒåŠ è½½æ‰€æœ‰ Model å®šä¹‰æ–‡ä»¶
- æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼š`js`ã€`ts`ã€`mjs`ã€`cjs`
- æ”¯æŒé€’å½’æ‰«æå­ç›®å½•
- æ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶åæ¨¡å¼ï¼ˆglob è¯­æ³•ï¼‰

**ä½¿ç”¨æ–¹å¼**:

#### ç®€åŒ–é…ç½®
```javascript
const msq = new MonSQLize({
    type: 'mongodb',
    databaseName: 'mydb',
    config: { uri: '...' },
    models: './models'  // â† ç®€åŒ–é…ç½®ï¼Œè‡ªåŠ¨åŠ è½½
});

await msq.connect();  // è‡ªåŠ¨æ‰«æ models/*.model.{js,ts,mjs,cjs}

// ç›´æ¥ä½¿ç”¨ï¼ˆæ— éœ€æ‰‹åŠ¨ Model.defineï¼‰
const User = msq.model('users');
```

#### å®Œæ•´é…ç½®
```javascript
const msq = new MonSQLize({
    type: 'mongodb',
    databaseName: 'mydb',
    config: { uri: '...' },
    models: {
        path: './models',               // Model æ–‡ä»¶ç›®å½•
        pattern: '*.model.js',          // æ–‡ä»¶åæ¨¡å¼ï¼ˆæ”¯æŒ globï¼‰
        recursive: true                 // é€’å½’æ‰«æå­ç›®å½•
    }
});

await msq.connect();
```

**Model æ–‡ä»¶æ ¼å¼**:
```javascript
// models/user.model.js
module.exports = {
    name: 'users',  // é›†åˆåç§°ï¼ˆå¿…éœ€ï¼‰
    
    schema: (dsl) => dsl({
        username: 'string:3-32!',
        email: 'email!'
    }),
    
    methods: (model) => ({
        instance: {
            checkPassword(password) {
                return this.password === password;
            }
        },
        static: {
            async findByUsername(username) {
                return await model.findOne({ username });
            }
        }
    }),
    
    hooks: (model) => ({
        insert: {
            before: async (ctx, doc) => {
                doc.createdAt = new Date();
                return doc;
            }
        }
    }),
    
    indexes: [
        { key: { username: 1 }, unique: true }
    ]
};
```

**ç›®å½•ç»“æ„ç¤ºä¾‹**:
```
models/
â”œâ”€â”€ user.model.js
â”œâ”€â”€ post.model.js
â”œâ”€â”€ comment.model.js
â””â”€â”€ admin/
    â”œâ”€â”€ role.model.js
    â””â”€â”€ permission.model.js
```

**æ”¯æŒçš„æ–‡ä»¶æ ¼å¼**:
- âœ… `.js` - CommonJS
- âœ… `.mjs` - ES Module
- âœ… `.cjs` - CommonJSï¼ˆæ˜¾å¼ï¼‰
- âœ… `.ts` - TypeScriptï¼ˆéœ€è¦ ts-nodeï¼‰

**é…ç½®é€‰é¡¹**:

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `path` | string | - | Model æ–‡ä»¶ç›®å½•ï¼ˆå¿…éœ€ï¼‰ |
| `pattern` | string | `*.model.{js,ts,mjs,cjs}` | æ–‡ä»¶åæ¨¡å¼ï¼ˆæ”¯æŒ globï¼‰ |
| `recursive` | boolean | `false` | æ˜¯å¦é€’å½’æ‰«æå­ç›®å½• |

**é”™è¯¯å¤„ç†**:

```
ç›®å½•ä¸å­˜åœ¨:
[Model] Models directory not found: /path/to/models

æ–‡ä»¶æ ¼å¼é”™è¯¯:
[Model] âŒ Failed to load models/invalid.model.js: export is null
[Model] âŒ Failed to load models/no-name.model.js: missing 'name' property

é‡å¤æ³¨å†Œ:
[Model] Model 'users' already registered, skipping models/user2.model.js
```

**æœ€ä½³å®è·µ**:
1. **ç»Ÿä¸€å‘½åè§„èŒƒ**: ä½¿ç”¨ `{name}.model.js` æ ¼å¼
2. **æŒ‰åŠŸèƒ½åˆ†ç»„**: ä½¿ç”¨å­ç›®å½•ç»„ç»‡ï¼ˆå¦‚ `admin/`ã€`public/`ï¼‰
3. **å¯¼å‡ºæ ¼å¼**: å§‹ç»ˆä½¿ç”¨ `module.exports = { name, ... }`
4. **æµ‹è¯•ç¯å¢ƒ**: å¯ä»¥ç¦ç”¨è‡ªåŠ¨åŠ è½½ï¼Œæ‰‹åŠ¨æ³¨å†Œæµ‹è¯• Model

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ æ–‡ä»¶å¿…é¡»åŒ…å« `name` å±æ€§
- âš ï¸ é‡å¤çš„ Model åç§°åªä¼šæ³¨å†Œç¬¬ä¸€ä¸ª
- âš ï¸ æ–‡ä»¶è¯­æ³•é”™è¯¯ä¼šå¯¼è‡´åŠ è½½å¤±è´¥ï¼ˆè®°å½•æ—¥å¿—ï¼Œä¸ä¸­æ–­ï¼‰
- âš ï¸ TypeScript æ–‡ä»¶éœ€è¦è¿è¡Œæ—¶æ”¯æŒï¼ˆts-node æˆ–ç¼–è¯‘åï¼‰

**ä¸æ‰‹åŠ¨æ³¨å†Œå¯¹æ¯”**:

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| æ‰‹åŠ¨æ³¨å†Œ | ç²¾ç¡®æ§åˆ¶ã€æ˜¾å¼ä¾èµ– | é‡å¤ä»£ç ã€ç»´æŠ¤æˆæœ¬é«˜ |
| è‡ªåŠ¨åŠ è½½ | è‡ªåŠ¨å‘ç°ã€ä»£ç ç®€æ´ | éšå¼ä¾èµ–ã€åŠ è½½é¡ºåºä¸ç¡®å®š |

**æ¨è**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è‡ªåŠ¨åŠ è½½ï¼Œæµ‹è¯•ç¯å¢ƒå¯é€‰æ‹©æ‰‹åŠ¨æ³¨å†Œã€‚

---

### 3. ç±»å‹å®šä¹‰å®Œå–„ âœ…

**æ–°å¢ç±»å‹**:
- âœ… `BaseOptions.models` - Model è‡ªåŠ¨åŠ è½½é…ç½®
  ```typescript
  interface BaseOptions {
      models?: string | {
          path: string;
          pattern?: string;
          recursive?: boolean;
      };
  }
  ```

- âœ… `ModelDefinition.options.validate` - Schema éªŒè¯é…ç½®
  ```typescript
  interface ModelDefinition {
      options?: {
          validate?: boolean;  // é»˜è®¤ true
      };
  }
  ```

**æ›´æ–°ç±»å‹**:
- âœ… å®Œå–„ `Model.define()` ç±»å‹å®šä¹‰
- âœ… å®Œå–„ `msq.model()` è¿”å›ç±»å‹

---

## æµ‹è¯•è¦†ç›– âœ…

### æ–°å¢æµ‹è¯•ç”¨ä¾‹ï¼ˆ35ä¸ªï¼Œ100%é€šè¿‡ï¼‰

**Model è‡ªåŠ¨åŠ è½½æµ‹è¯•** (19ä¸ª):
- âœ… ç®€åŒ–é…ç½®ï¼ˆå­—ç¬¦ä¸²è·¯å¾„ï¼‰
- âœ… é»˜è®¤ pattern éªŒè¯
- âœ… ä¸é€’å½’æ‰«æï¼ˆé»˜è®¤ï¼‰
- âœ… è‡ªå®šä¹‰ pattern
- âœ… é€’å½’æ‰«æ
- âœ… å¤šç§æ–‡ä»¶æ ¼å¼ï¼ˆjs/mjs/cjsï¼‰
- âœ… æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆç¼ºå°‘ nameã€ç©º nameã€null exportï¼‰
- âœ… ç›®å½•ä¸å­˜åœ¨å¤„ç†
- âœ… æ–‡ä»¶åŠ è½½å¤±è´¥å¤„ç†
- âœ… é˜²æ­¢é‡å¤æ³¨å†Œ
- âœ… æ— æ•ˆé…ç½®å¤„ç†
- âœ… connect() åå¯ç”¨
- âœ… Schema éªŒè¯é›†æˆ
- âœ… è‡ªå®šä¹‰æ–¹æ³•æ”¯æŒ
- âœ… Hooks æ”¯æŒ
- âœ… æ—¥å¿—è¾“å‡ºéªŒè¯

**Schema éªŒè¯æµ‹è¯•** (16ä¸ª):
- âœ… é»˜è®¤å¯ç”¨éªŒè¯
- âœ… insertOne æ—¶éªŒè¯
- âœ… insertMany æ—¶é€ä¸ªéªŒè¯
- âœ… è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯
- âœ… æŒ‡ç¤ºé”™è¯¯å­—æ®µå
- âœ… æŒ‡ç¤ºé”™è¯¯ç±»å‹
- âœ… æ‰¹é‡æ’å…¥é”™è¯¯ç´¢å¼•
- âœ… å…¨å±€ç¦ç”¨éªŒè¯
- âœ… å•æ¬¡æ“ä½œè·³è¿‡éªŒè¯
- âœ… è·³è¿‡éªŒè¯æ—¶ä»æ‰§è¡Œ hooks
- âœ… æœªå®šä¹‰ schema çš„ Model æ— å½±å“
- âœ… v1.0.4 é£æ ¼é…ç½®å…¼å®¹
- âœ… å¯é€‰å­—æ®µæ­£ç¡®å¤„ç†
- âœ… æ€§èƒ½å½±å“æµ‹è¯•ï¼ˆéªŒè¯å¼€é”€ <30%ï¼‰
- âœ… åµŒå¥—å¯¹è±¡éªŒè¯
- âœ… æ•°ç»„éªŒè¯

### æµ‹è¯•è¦†ç›–ç‡

| åŠŸèƒ½æ¨¡å— | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|---------|---------|--------|--------|
| Model è‡ªåŠ¨åŠ è½½ | 19 | **100%** âœ… | ~95% |
| Schema éªŒè¯ | 16 | **100%** âœ… | ~90% |
| **æ€»è®¡** | **35** | **100%** âœ… | **~92%** |

---

## æ–‡æ¡£å®Œå–„ ğŸ“–

### æ–°å¢æ–‡æ¡£

1. **`docs/model.md`** - æ›´æ–°ï¼ˆæ–°å¢ 1,700 å­—ï¼‰
   - Model è‡ªåŠ¨åŠ è½½ç« èŠ‚
   - Schema éªŒè¯ç« èŠ‚
   - é…ç½®é€‰é¡¹è¯¦è§£
   - æœ€ä½³å®è·µ

2. **`examples/model/auto-load.js`** - Model è‡ªåŠ¨åŠ è½½ç¤ºä¾‹
   - ç®€åŒ–é…ç½®ç¤ºä¾‹
   - å®Œæ•´é…ç½®ç¤ºä¾‹
   - Schema éªŒè¯ç¤ºä¾‹

3. **`examples/model/schema-validation.js`** - Schema éªŒè¯ç¤ºä¾‹
   - åŸºæœ¬éªŒè¯
   - éªŒè¯é”™è¯¯è¯¦æƒ…
   - å¯é€‰å­—æ®µ
   - è·³è¿‡éªŒè¯
   - åµŒå¥—å¯¹è±¡éªŒè¯

4. **`examples/model/models/`** - Model å®šä¹‰æ–‡ä»¶ç¤ºä¾‹
   - `user.model.js` - User Model å®šä¹‰
   - `post.model.js` - Post Model å®šä¹‰
   - `admin/role.model.js` - Role Model å®šä¹‰ï¼ˆå­ç›®å½•ï¼‰

### æ›´æ–°æ–‡æ¡£

1. **`README.md`** - æ›´æ–°ç‰¹æ€§åˆ—è¡¨å’Œä½¿ç”¨ç¤ºä¾‹
2. **`index.d.ts`** - å®Œå–„ TypeScript ç±»å‹å®šä¹‰

---

## åç»­è®¡åˆ’ ğŸ—ºï¸

### æµ‹è¯•å®Œå–„ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- âœ… ç¼–å†™ Model è‡ªåŠ¨åŠ è½½æµ‹è¯•ç”¨ä¾‹ï¼ˆ19ä¸ªï¼‰
- âœ… ç¼–å†™ Schema éªŒè¯é»˜è®¤å¯ç”¨æµ‹è¯•ï¼ˆ16ä¸ªï¼‰
- âœ… éªŒè¯ç°æœ‰æµ‹è¯•å…¼å®¹æ€§

### æ–‡æ¡£å®Œå–„ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- âœ… æ›´æ–° `docs/model.md` - æ·»åŠ  Schema éªŒè¯ç« èŠ‚
- âœ… æ›´æ–° `docs/model.md` - æ·»åŠ è‡ªåŠ¨åŠ è½½ç« èŠ‚
- âœ… æ·»åŠ è¿ç§»æŒ‡å—

### åŠŸèƒ½å¢å¼ºï¼ˆè®¡åˆ’ä¸­ï¼Œv1.1.0ï¼‰
- [ ] æ”¯æŒè·¨æ•°æ®åº“ Model æ“ä½œ
- [ ] Model å±‚æ€§èƒ½ä¼˜åŒ–
- [ ] æ›´å¤šç¤ºä¾‹å’Œæœ€ä½³å®è·µ

---

## ä½¿ç”¨å»ºè®® ğŸ’¡

### æ¨èå‡çº§

**æ¨èå‡çº§**: âœ… å¼ºçƒˆæ¨è

**å‡çº§å‘½ä»¤**:
```bash
npm install monsqlize@1.0.5
```

### æ³¨æ„äº‹é¡¹

1. âœ… å¦‚æœä½ çš„ Model å·²å®šä¹‰ schemaï¼Œå‡çº§åä¼šè‡ªåŠ¨å¯ç”¨éªŒè¯
2. âœ… å¦‚æœéªŒè¯å¤±è´¥ï¼Œä¼šæŠ›å‡º `VALIDATION_ERROR` é”™è¯¯
3. âœ… å¯é€šè¿‡ `validate: false` ç¦ç”¨éªŒè¯ï¼ˆä¸æ¨èï¼‰
4. âœ… å¯é€šè¿‡ `models` é…ç½®å¯ç”¨è‡ªåŠ¨åŠ è½½ï¼Œå‡å°‘æ‰‹åŠ¨æ³¨å†Œä»£ç 

### æœ€ä½³å®è·µ

**Schema éªŒè¯**:
- âœ… å§‹ç»ˆå®šä¹‰ schemaï¼Œä¿è¯æ•°æ®è´¨é‡
- âœ… åˆç†ä½¿ç”¨å¯é€‰å­—æ®µï¼Œé¿å…è¿‡åº¦ä¸¥æ ¼
- âœ… ä½¿ç”¨ hooks æ·»åŠ å¤æ‚éªŒè¯é€»è¾‘
- âœ… æ•è· `VALIDATION_ERROR` è¿”å›å‹å¥½é”™è¯¯

**Model è‡ªåŠ¨åŠ è½½**:
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„æ–‡ä»¶å‘½åè§„èŒƒï¼ˆ`*.model.js`ï¼‰
- âœ… æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ç›®å½•ç»“æ„
- âœ… æµ‹è¯•ç¯å¢ƒå¯æ‰‹åŠ¨æ³¨å†Œï¼Œä¿æŒçµæ´»æ€§

---

## è·å–å¸®åŠ© ğŸ’¬

- ğŸ“– [å®Œæ•´æ–‡æ¡£](../docs/INDEX.md)
- ğŸ’¬ [GitHub Issues](https://github.com/vextjs/monSQLize/issues)
- ğŸ“§ [é‚®ä»¶æ”¯æŒ](mailto:support@monsqlize.com)

---

**æœ€åæ›´æ–°**: 2026-01-08

