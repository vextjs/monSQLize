# æµ‹è¯•ç›®å½•è¯´æ˜

æœ¬ç›®å½•åŒ…å« monSQLize é¡¹ç›®çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ã€‚

## ç›®å½•ç»“æ„

æŒ‰ç…§è§„èŒƒï¼ˆguidelines v2.0 ç¬¬21ç« ï¼‰ï¼Œæµ‹è¯•ç›®å½•é‡‡ç”¨æ ‡å‡†çš„ unit/integration/e2e ç»“æ„ï¼Œ**å•å…ƒæµ‹è¯•å†…éƒ¨æŒ‰åŠŸèƒ½åˆ†ç±»**ï¼š

```
test/
â”œâ”€â”€ unit/                            # å•å…ƒæµ‹è¯•ï¼ˆå¼ºåˆ¶ï¼‰âœ…
â”‚   â”œâ”€â”€ features/                   # åŠŸèƒ½æ€§æµ‹è¯•ï¼ˆä¸šåŠ¡åŠŸèƒ½ï¼‰
â”‚   â”‚   â”œâ”€â”€ find.test.js
â”‚   â”‚   â”œâ”€â”€ findOne.test.js
â”‚   â”‚   â”œâ”€â”€ findPage.test.js
â”‚   â”‚   â”œâ”€â”€ count.test.js
â”‚   â”‚   â”œâ”€â”€ aggregate.test.js
â”‚   â”‚   â””â”€â”€ distinct.test.js
â”‚   â”œâ”€â”€ infrastructure/             # åŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆåº•å±‚æ”¯æ’‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ connection.test.js
â”‚   â”‚   â”œâ”€â”€ connection-simple.test.js
â”‚   â”‚   â”œâ”€â”€ errors.test.js
â”‚   â”‚   â””â”€â”€ logger.test.js
â”‚   â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆçº¯å‡½æ•°ï¼‰
â”‚       â””â”€â”€ (å¾…æ·»åŠ )
â”‚
â”œâ”€â”€ integration/                     # é›†æˆæµ‹è¯•ï¼ˆæ¨èï¼‰
â”‚   â””â”€â”€ (å¾…æ·»åŠ )
â”‚
â”œâ”€â”€ e2e/                            # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ (å¾…æ·»åŠ )
â”‚
â”œâ”€â”€ README.md                       # æœ¬æ–‡ä»¶
â””â”€â”€ run-tests.js                    # æµ‹è¯•è¿è¡Œå™¨ï¼ˆå·²æ›´æ–°æ”¯æŒåˆ†ç±»ç»“æ„ï¼‰
```

### è¿ç§»çŠ¶æ€

âœ… **å·²å®Œæˆ**: 
- æ‰€æœ‰å•å…ƒæµ‹è¯•å·²è¿ç§»åˆ° `test/unit/` ç›®å½•ï¼ˆ2025-11-04ï¼‰
- **æŒ‰è§„èŒƒåˆ†ç±»åˆ° features/ å’Œ infrastructure/ å­ç›®å½•**ï¼ˆ2025-11-04ï¼‰

**æ³¨æ„**: éªŒè¯è„šæœ¬å·²ç§»åŠ¨åˆ° `scripts/verify/` ç›®å½•ï¼Œå‚è§ [scripts/README.md](../scripts/README.md)ã€‚

## æµ‹è¯•åˆ†ç±»è¯´æ˜

### åŠŸèƒ½æ€§æµ‹è¯•ï¼ˆfeatures/ï¼‰
**æµ‹è¯•å¯¹è±¡**: å¯¹å¤–æš´éœ²çš„ API å’Œä¸šåŠ¡åŠŸèƒ½

**åŒ…å«æ–‡ä»¶**:
- `find.test.js` - æ‰¹é‡æŸ¥è¯¢æµ‹è¯•
- `findOne.test.js` - å•æ–‡æ¡£æŸ¥è¯¢æµ‹è¯•
- `findPage.test.js` - æ·±åº¦åˆ†é¡µæµ‹è¯•
- `count.test.js` - ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•
- `aggregate.test.js` - èšåˆæŸ¥è¯¢æµ‹è¯•
- `distinct.test.js` - å­—æ®µå»é‡æµ‹è¯•

### åŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆinfrastructure/ï¼‰
**æµ‹è¯•å¯¹è±¡**: åº•å±‚æ”¯æ’‘ç³»ç»Ÿå’Œå†…éƒ¨å·¥å…·

**åŒ…å«æ–‡ä»¶**:
- `connection.test.js` - è¿æ¥ç®¡ç†æµ‹è¯•
- `connection-simple.test.js` - è¿æ¥ç®¡ç†ç®€åŒ–æµ‹è¯•
- `errors.test.js` - é”™è¯¯ç ç³»ç»Ÿæµ‹è¯•
- `logger.test.js` - æ—¥å¿—ç³»ç»Ÿæµ‹è¯•

### å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆutils/ï¼‰
**æµ‹è¯•å¯¹è±¡**: çº¯å‡½æ•°å’Œè¾…åŠ©å·¥å…·

**çŠ¶æ€**: å¾…æ·»åŠ ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

## æµ‹è¯•åˆ†ç±»

### 1. æ ¸å¿ƒ API æµ‹è¯•ï¼ˆCore API Testsï¼‰
æµ‹è¯•æ‰€æœ‰å¯¹å¤–æš´éœ²çš„è¯»æ“ä½œ APIï¼š
- **find**: æ‰¹é‡æŸ¥è¯¢ã€æµå¼æŸ¥è¯¢
- **findOne**: å•æ–‡æ¡£æŸ¥è¯¢
- **findPage**: æ·±åº¦åˆ†é¡µï¼ˆæ¸¸æ ‡ã€è·³é¡µã€totalsï¼‰
- **count**: æ–‡æ¡£ç»Ÿè®¡
- **aggregate**: èšåˆç®¡é“
- **distinct**: å­—æ®µå»é‡

### 2. åŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆInfrastructure Testsï¼‰
æµ‹è¯•åº•å±‚åŸºç¡€åŠŸèƒ½ï¼š
- **connection**: è¿æ¥æ± ç®¡ç†ã€è·¨åº“è®¿é—®
- **errors**: ç»Ÿä¸€é”™è¯¯ç ç³»ç»Ÿ
- **logger**: æ—¥å¿—ç³»ç»Ÿï¼ˆtraceIdã€ç»“æ„åŒ–æ—¥å¿—ï¼‰

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npm test
# æˆ–
node test/run-tests.js
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
```bash
node test/find.test.js
node test/findPage.test.js
```

### è¿è¡Œ P0 éªŒè¯
```bash
node test/verify-p0.js
```

## æµ‹è¯•è§„èŒƒ

### æ–‡ä»¶å‘½å
- æµ‹è¯•æ–‡ä»¶: `<åŠŸèƒ½å>.test.js`
- ç¤ºä¾‹æ–‡ä»¶: `examples/<åŠŸèƒ½å>.examples.js`

### æµ‹è¯•è¦†ç›–è¦æ±‚
æ¯ä¸ªæµ‹è¯•æ–‡ä»¶åº”åŒ…å«ï¼š
1. âœ… **æ­£å¸¸è·¯å¾„**: ä¸»è¦ä½¿ç”¨åœºæ™¯
2. âœ… **å¼‚å¸¸è·¯å¾„**: éæ³•è¾“å…¥ã€è¾¹ç•Œæ¡ä»¶
3. âœ… **è¾¹ç•Œç”¨ä¾‹**: ç©ºå€¼ã€æœ€å°/æœ€å¤§å€¼ã€å¹¶å‘ã€è¶…æ—¶

### æµ‹è¯•ç»“æ„
```javascript
console.log('\nğŸ“¦ <åŠŸèƒ½åç§°>æµ‹è¯•å¥—ä»¶\n');

// æµ‹è¯•å¥—ä»¶ 1: åŸºç¡€åŠŸèƒ½
console.log('ğŸ“¦ 1. åŸºç¡€åŠŸèƒ½');
function test1() { /* ... */ }
test1();

// æµ‹è¯•å¥—ä»¶ 2: é«˜çº§åŠŸèƒ½
console.log('ğŸ“¦ 2. é«˜çº§åŠŸèƒ½');
function test2() { /* ... */ }
test2();

// ... æ›´å¤šæµ‹è¯•å¥—ä»¶

console.log('\nâœ… <åŠŸèƒ½åç§°>æµ‹è¯•å…¨éƒ¨é€šè¿‡\n');
```

## æµ‹è¯•ä¾èµ–

### å¤–éƒ¨ä¾èµ–
- **MongoDB**: éœ€è¦çœŸå® MongoDB å®ä¾‹ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰
  - é»˜è®¤è¿æ¥: `mongodb://localhost:27017`
  - æµ‹è¯•æ•°æ®åº“: å„æµ‹è¯•æ–‡ä»¶ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“å

### æœªæ¥è®¡åˆ’
- [ ] é›†æˆ `mongodb-memory-server` å®ç°çº¯å†…å­˜æµ‹è¯•
- [ ] æ·»åŠ ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼ˆIstanbul/nycï¼‰
- [ ] æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

## æµ‹è¯•æ•°æ®

### æµ‹è¯•æ•°æ®åº“å‘½å
- è¿æ¥æµ‹è¯•: `test_connection`
- æŸ¥è¯¢æµ‹è¯•: `test_<åŠŸèƒ½å>`
- ç¤ºä¾‹: `test_find`, `test_findPage`

### æµ‹è¯•æ•°æ®æ¸…ç†
- æ¯ä¸ªæµ‹è¯•å¥—ä»¶è´Ÿè´£æ¸…ç†è‡ªå·±åˆ›å»ºçš„æ•°æ®
- ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“åé¿å…å†²çª

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥
```
Error: connect ECONNREFUSED 127.0.0.1:27017
```
**è§£å†³**: ç¡®ä¿ MongoDB æœåŠ¡æ­£åœ¨è¿è¡Œ
```bash
# Windows
net start MongoDB

# Linux/Mac
sudo systemctl start mongod
```

#### 2. æµ‹è¯•è¶…æ—¶
**è§£å†³**: æ£€æŸ¥ MongoDB æ€§èƒ½æˆ–å¢åŠ è¶…æ—¶æ—¶é—´

#### 3. ç«¯å£å†²çª
**è§£å†³**: ä¿®æ”¹æµ‹è¯•é…ç½®ä¸­çš„è¿æ¥ URI

## è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨é€‚å½“çš„ç›®å½•åˆ›å»º `<åŠŸèƒ½>.test.js`
2. éµå¾ªæµ‹è¯•è§„èŒƒç¼–å†™æµ‹è¯•ç”¨ä¾‹
3. åœ¨ `run-tests.js` ä¸­æ³¨å†Œæµ‹è¯•æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰
4. è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡
5. æ›´æ–°æœ¬ READMEï¼ˆå¦‚æœ‰æ–°åˆ†ç±»ï¼‰

### æµ‹è¯•æœ€ä½³å®è·µ
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œé¿å…æ±¡æŸ“æ•°æ®åº“
- ä½¿ç”¨ `assert` è¿›è¡Œæ–­è¨€
- æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯

## å‚è€ƒæ–‡æ¡£

- [é¡¹ç›®è§„èŒƒ](../guidelines/profiles/monSQLize.md)
- [é€šç”¨æµ‹è¯•è§„èŒƒ](../guidelines/guidelines/v2.md#7-æµ‹è¯•ä¸è´¨é‡)
- [ç¤ºä¾‹ä»£ç ](../examples/)

---

**æœ€åæ›´æ–°**: 2025-11-04  
**ç»´æŠ¤è€…**: monSQLize Team

