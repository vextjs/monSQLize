# monSQLize å…¼å®¹æ€§çŸ©é˜µ

**æœ€åæ›´æ–°**: 2025-01-02  
**ç‰ˆæœ¬**: 1.0.0

---

## ğŸ“‘ ç›®å½•

- [ğŸ“Š æ¦‚è¿°](#-æ¦‚è¿°)
- [ğŸŸ¢ Node.js ç‰ˆæœ¬æ”¯æŒ](#-nodejs-ç‰ˆæœ¬æ”¯æŒ)
- [ğŸ”µ MongoDB Driver ç‰ˆæœ¬æ”¯æŒ](#-mongodb-driver-ç‰ˆæœ¬æ”¯æŒ)
- [ğŸŸ  MongoDB Server ç‰ˆæœ¬æ”¯æŒ](#-mongodb-server-ç‰ˆæœ¬æ”¯æŒ)
- [ğŸ§ª ç»„åˆå…¼å®¹æ€§çŸ©é˜µ](#-ç»„åˆå…¼å®¹æ€§çŸ©é˜µ)
- [ğŸ“¦ ä¾èµ–ç‰ˆæœ¬](#-ä¾èµ–ç‰ˆæœ¬)
- [ğŸš€ æµ‹è¯•çŸ©é˜µ](#-æµ‹è¯•çŸ©é˜µ)
- [ğŸ“– ä½¿ç”¨å»ºè®®](#-ä½¿ç”¨å»ºè®®)
- [âš ï¸ å·²çŸ¥é™åˆ¶](#ï¸-å·²çŸ¥é™åˆ¶)
- [ğŸ” å¦‚ä½•æ£€æµ‹å½“å‰ç¯å¢ƒ](#-å¦‚ä½•æ£€æµ‹å½“å‰ç¯å¢ƒ)
- [ğŸ“ æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)
- [ğŸ¤ è´¡çŒ®](#-è´¡çŒ®)
- [ğŸ“ æ”¯æŒ](#-æ”¯æŒ)

---

## ï¿½ğŸ“Š æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜ monSQLize æ”¯æŒçš„ Node.jsã€MongoDB Driver å’Œ MongoDB Server ç‰ˆæœ¬èŒƒå›´ã€‚

---

## ğŸŸ¢ Node.js ç‰ˆæœ¬æ”¯æŒ

| Node.js ç‰ˆæœ¬ | æ”¯æŒçŠ¶æ€ | æµ‹è¯•çŠ¶æ€ | å¤‡æ³¨ |
|-------------|---------|---------|------|
| **16.x** | âœ… æ”¯æŒ | âœ… å·²æµ‹è¯• | æœ€ä½æ”¯æŒç‰ˆæœ¬ï¼ˆ>=16.0.0ï¼‰ï¼ŒLTS |
| **18.x** | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | **LTSï¼ˆæ¨èï¼‰** |
| **20.x** | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | **LTSï¼ˆæ¨èï¼‰** |
| **22.x** | âœ… æ”¯æŒ | âœ… å·²æµ‹è¯• | æœ€æ–°ç‰ˆæœ¬ |
| **14.x** | âŒ ä¸æ”¯æŒ | - | å·²ç§»é™¤æ”¯æŒ |
| **12.x** | âŒ ä¸æ”¯æŒ | - | å·² EOL |

### Node.js ç‰¹æ€§æ”¯æŒ

| ç‰¹æ€§ | Node.js ç‰ˆæœ¬è¦æ±‚ | monSQLize æ”¯æŒ |
|------|----------------|---------------|
| async/await | 7.6+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |
| Promise.allSettled | 12.9+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |
| å¯é€‰é“¾ (?.) | 14.0+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |
| Worker Threads | 16.0+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |
| ç©ºå€¼åˆå¹¶ (??) | 14.0+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |
| Worker Threads | 16.0+ | âœ… æ¡ä»¶æ”¯æŒï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰ |
| performance.now() | 8.5+ | âœ… å…¨ç‰ˆæœ¬æ”¯æŒ |

---

## ğŸ”µ MongoDB Driver ç‰ˆæœ¬æ”¯æŒ

| Driver ç‰ˆæœ¬ | æ”¯æŒçŠ¶æ€ | æµ‹è¯•çŠ¶æ€ | å·²çŸ¥é—®é¢˜ | æ¨èåº¦ |
|------------|---------|---------|---------|--------|
| **4.x** (4.17.2) | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âœ… å·²æµ‹è¯• | è¿æ¥é€‰é¡¹å¿…éœ€è®¾ç½® | â­â­ |
| **5.x** (5.9.2) | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | findOneAnd* è¿”å›æ ¼å¼ä¸åŒ | â­â­â­ |
| **6.x** (6.17.0) | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | æ—  | â­â­â­â­â­ **æ¨è** |
| **7.x** | ğŸ”¶ å®éªŒæ€§ | â¸ï¸ å¾…æµ‹è¯• | å¾…éªŒè¯ | â­â­â­ |
| **3.x** | âŒ ä¸æ”¯æŒ | - | å¤ªæ—§ | - |

### Driver 4.x ä½¿ç”¨æ³¨æ„äº‹é¡¹

Driver 4.x éœ€è¦æ˜¾å¼è®¾ç½®è¿æ¥é€‰é¡¹ï¼š

```javascript
const MonSQLize = require('monsqlize');

const msq = new MonSQLize({
  uri: 'mongodb://localhost:27017',
  config: {
    // Driver 4.x å¿…éœ€çš„é€‰é¡¹
    useNewUrlParser: true,
    useUnifiedTopology: true,
    poolSize: 10,
  }
});
```

### Driver 5.x vs 6.x å·®å¼‚

**findOneAnd* è¿”å›å€¼å˜åŒ–**ï¼ˆæœ€é‡è¦ï¼‰ï¼š

```javascript
// Driver 5.x: è¿”å›å®Œæ•´å…ƒæ•°æ®
const result = await collection.findOneAndUpdate(filter, update);
console.log(result);
// { value: {...}, ok: 1, lastErrorObject: {...} }

// Driver 6.x: é»˜è®¤è¿”å›æ–‡æ¡£
const result = await collection.findOneAndUpdate(filter, update);
console.log(result);
// { _id: ..., name: "Alice" }  // ç›´æ¥è¿”å›æ–‡æ¡£

// Driver 6.x: è·å–å®Œæ•´å…ƒæ•°æ®
const result = await collection.findOneAndUpdate(filter, update, {
  includeResultMetadata: true
});
console.log(result);
// { value: {...}, ok: 1 }
```

**monSQLize çš„å¤„ç†æ–¹å¼**:
- âœ… è‡ªåŠ¨æ£€æµ‹é©±åŠ¨ç‰ˆæœ¬
- âœ… ç»Ÿä¸€è¿”å›æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
- âœ… ç”¨æˆ·æ— éœ€å…³å¿ƒå·®å¼‚

---

## ğŸŸ  MongoDB Server ç‰ˆæœ¬æ”¯æŒ

| Server ç‰ˆæœ¬ | æ”¯æŒçŠ¶æ€ | æµ‹è¯•çŠ¶æ€ | ç‰¹æ€§é™åˆ¶ | æ¨èåº¦ |
|------------|---------|---------|---------|--------|
| **4.4** | âœ… æ”¯æŒ | âœ… å·²æµ‹è¯• | åŸºç¡€åŠŸèƒ½ï¼Œéƒ¨åˆ†èšåˆæ“ä½œç¬¦ä¸å¯ç”¨ | â­â­â­ |
| **5.0** | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | æ”¯æŒæ—¶é—´åºåˆ—é›†åˆ | â­â­â­â­ |
| **6.0** | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | æ”¯æŒåŠ å¯†å­—æ®µ | â­â­â­â­â­ **æ¨è** |
| **7.0** | âœ… å®Œå…¨æ”¯æŒ | âœ… å·²æµ‹è¯• | æœ€æ–°ç‰¹æ€§ | â­â­â­â­â­ |
| **4.0-4.2** | âš ï¸ å¯èƒ½å…¼å®¹ | â¸ï¸ æœªæµ‹è¯• | æœªéªŒè¯ | â­â­ |
| **3.x** | âŒ ä¸æ”¯æŒ | - | å¤ªæ—§ | - |

### MongoDB Server ç‰¹æ€§æ”¯æŒ

| ç‰¹æ€§ | Server ç‰ˆæœ¬è¦æ±‚ | monSQLize æ”¯æŒ |
|------|----------------|---------------|
| **äº‹åŠ¡** | 4.0+ (å‰¯æœ¬é›†) | âœ… å®Œå…¨æ”¯æŒ |
| **å¤šæ–‡æ¡£äº‹åŠ¡** | 4.0+ (å‰¯æœ¬é›†), 4.2+ (åˆ†ç‰‡) | âœ… å®Œå…¨æ”¯æŒ |
| **é€šé…ç¬¦ç´¢å¼•** | 4.2+ | âœ… å®Œå…¨æ”¯æŒ |
| **$function æ“ä½œç¬¦** | 4.4+ | âœ… è‡ªåŠ¨æ£€æµ‹ |
| **$setWindowFields** | 5.0+ | âœ… è‡ªåŠ¨æ£€æµ‹ |
| **æ—¶é—´åºåˆ—é›†åˆ** | 5.0+ | âœ… å®Œå…¨æ”¯æŒ |
| **åŠ å¯†å­—æ®µ** | 6.0+ | âœ… å®Œå…¨æ”¯æŒ |

---

## ğŸ§ª ç»„åˆå…¼å®¹æ€§çŸ©é˜µ

### æ¨èç»„åˆ â­â­â­â­â­

| Node.js | MongoDB Driver | MongoDB Server | çŠ¶æ€ | é€‚ç”¨åœºæ™¯ |
|---------|---------------|----------------|------|---------|
| 20.x | 6.17.0 | 6.0 / 7.0 | âœ… å®Œç¾ | **ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰** |
| 18.x | 6.17.0 | 6.0 / 7.0 | âœ… å®Œç¾ | **ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰** |
| 20.x | 6.17.0 | 5.0 | âœ… ä¼˜ç§€ | ç”Ÿäº§ç¯å¢ƒ |
| 18.x | 5.9.2 | 5.0 | âœ… è‰¯å¥½ | å…¼å®¹æ—§é¡¹ç›® |

### æ”¯æŒçš„ç»„åˆ â­â­â­

| Node.js | MongoDB Driver | MongoDB Server | çŠ¶æ€ | é€‚ç”¨åœºæ™¯ |
|---------|---------------|----------------|------|---------|
| 16.x | 6.17.0 | 6.0 | âœ… æ”¯æŒ | æ—§é¡¹ç›®å‡çº§ |
| 14.x | 5.9.2 | 4.4 | âœ… æ”¯æŒ | æœ€ä½å…¼å®¹é…ç½® |
| 22.x | 6.17.0 | 7.0 | âœ… æ”¯æŒ | å°é²œ |

### ä¸æ¨èçš„ç»„åˆ âš ï¸

| Node.js | MongoDB Driver | MongoDB Server | çŠ¶æ€ | åŸå›  |
|---------|---------------|----------------|------|------|
| 14.x | 4.17.2 | ä»»æ„ | âš ï¸ å‹‰å¼º | Driver 4.x é…ç½®å¤æ‚ |
| ä»»æ„ | 7.x | ä»»æ„ | ğŸ”¶ æœªçŸ¥ | Driver 7.x å¾…å…¨é¢æµ‹è¯• |

### ä¸æ”¯æŒçš„ç»„åˆ âŒ

| Node.js | MongoDB Driver | MongoDB Server | çŠ¶æ€ | åŸå›  |
|---------|---------------|----------------|------|------|
| 12.x | ä»»æ„ | ä»»æ„ | âŒ ä¸æ”¯æŒ | Node.js 12 å·² EOL |
| ä»»æ„ | 3.x | ä»»æ„ | âŒ ä¸æ”¯æŒ | Driver 3.x å¤ªæ—§ |
| ä»»æ„ | ä»»æ„ | 3.x | âŒ ä¸æ”¯æŒ | Server 3.x å¤ªæ—§ |

---

## ğŸ“¦ ä¾èµ–ç‰ˆæœ¬

### æ ¸å¿ƒä¾èµ–

```json
{
  "dependencies": {
    "mongodb": "^6.17.0"
  },
  "optionalDependencies": {
    "ioredis": "^5.8.2"
  }
}
```

### å¼€å‘ä¾èµ–

```json
{
  "devDependencies": {
    "mongodb-memory-server": "^10.1.2",
    "mocha": "^11.7.5",
    "chai": "^6.2.1"
  }
}
```

---

## ğŸš€ æµ‹è¯•çŸ©é˜µ

### CI/CD æµ‹è¯•è¦†ç›–

#### æ ¸å¿ƒæµ‹è¯•ï¼ˆæ¯æ¬¡ PRï¼‰
- Node.js: 18.x, 20.x
- MongoDB Driver: 6.17.0
- OS: Ubuntu, Windows

#### å®Œæ•´æµ‹è¯•ï¼ˆmerge åˆ° main / æ¯æ—¥å®šæ—¶ï¼‰
- Node.js: 14.x, 16.x, 18.x, 20.x, 22.x
- MongoDB Driver: 4.17.2, 5.9.2, 6.17.0
- OS: Ubuntu
- çº¦ 15 ç§ç»„åˆ

---

## ğŸ“– ä½¿ç”¨å»ºè®®

### æ–°é¡¹ç›®
```
æ¨èé…ç½®:
- Node.js 20.x (LTS)
- MongoDB Driver 6.17.0
- MongoDB Server 6.0 æˆ– 7.0
```

### å‡çº§ç°æœ‰é¡¹ç›®

#### ä» Driver 4.x å‡çº§åˆ° 6.x
1. æ›´æ–° package.json: `"mongodb": "^6.17.0"`
2. ç§»é™¤æ—§çš„è¿æ¥é€‰é¡¹ï¼ˆuseNewUrlParser ç­‰ï¼‰
3. è¿è¡Œæµ‹è¯•éªŒè¯å…¼å®¹æ€§
4. monSQLize ä¼šè‡ªåŠ¨é€‚é…å·®å¼‚

#### ä» Node.js 14 å‡çº§åˆ° 18/20
1. æ›´æ–° Node.js ç‰ˆæœ¬
2. æ›´æ–°ä¾èµ–: `npm update`
3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
4. æ— éœ€ä¿®æ”¹ monSQLize ä½¿ç”¨æ–¹å¼

---

## âš ï¸ å·²çŸ¥é™åˆ¶

### 1. Driver 4.x è¿æ¥é€‰é¡¹
**é—®é¢˜**: å¿…é¡»æ˜¾å¼è®¾ç½® useNewUrlParser ç­‰é€‰é¡¹  
**å½±å“**: é…ç½®å¤æ‚  
**è§£å†³**: ä½¿ç”¨ version-adapter æä¾›çš„æ¨èé€‰é¡¹

### 2. findOneAnd* è¿”å›å€¼å·®å¼‚
**é—®é¢˜**: Driver 5.x å’Œ 6.x è¿”å›æ ¼å¼ä¸åŒ  
**å½±å“**: å¯èƒ½ç ´åä¾èµ–è¿”å›å€¼çš„ä»£ç   
**è§£å†³**: monSQLize è‡ªåŠ¨ç»Ÿä¸€æ ¼å¼

### 3. Worker Threads ä»… Node.js 16+
**é—®é¢˜**: Node.js 14/15 ä¸æ”¯æŒ Worker Threads  
**å½±å“**: éƒ¨åˆ†å¹¶å‘ç‰¹æ€§ä¸å¯ç”¨  
**è§£å†³**: è‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡

---

## ğŸ” å¦‚ä½•æ£€æµ‹å½“å‰ç¯å¢ƒ

### ä½¿ç”¨ monSQLize çš„ç‰ˆæœ¬é€‚é…å™¨

```javascript
const versionAdapter = require('monsqlize/test/utils/version-adapter');

// ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
const report = versionAdapter.generateReport();
console.log(report);

// è¾“å‡ºç¤ºä¾‹:
// {
//   node: {
//     version: 'v20.19.4',
//     major: 20,
//     features: {
//       workerThreads: true,
//       performanceNow: true,
//       promiseAllSettled: true
//     }
//   },
//   mongodbDriver: {
//     version: '6.17.0',
//     major: 6,
//     features: {
//       simplifiedFindOneAnd: true,
//       modernConnectionOptions: true
//     }
//   },
//   compatibility: {
//     recommendedConnectionOptions: {...},
//     needsFindOneAndAdaptation: true
//   }
// }
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-01-02
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… æ”¯æŒ Node.js 14-22
- âœ… æ”¯æŒ MongoDB Driver 4.x-6.x
- âœ… æ”¯æŒ MongoDB Server 4.4-7.0
- âœ… æ·»åŠ ç‰ˆæœ¬é€‚é…å™¨
- âœ… æ·»åŠ  CI/CD æµ‹è¯•çŸ©é˜µ

---

## ğŸ¤ è´¡çŒ®

å‘ç°å…¼å®¹æ€§é—®é¢˜ï¼Ÿè¯·æäº¤ Issue æˆ– PRï¼š
- GitHub Issues: https://github.com/vextjs/monSQLize/issues
- å…¼å®¹æ€§æŠ¥å‘Šæ¨¡æ¿: [ISSUE_TEMPLATE/compatibility.md]

---

## ğŸ“ æ”¯æŒ

- ğŸ“– æ–‡æ¡£: [docs/](./INDEX.md)
- ğŸ’¬ è®¨è®º: [GitHub Discussions](https://github.com/vextjs/monSQLize/discussions)
- ğŸ› Bug Report: [GitHub Issues](https://github.com/vextjs/monSQLize/issues)

---

**ç»´æŠ¤è€…**: vext.js Team  
**è®¸å¯è¯**: MIT

